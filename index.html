<!DOCTYPE html>
<html>
<head>
  <title>Accelerometer Sensoree</title>  

  <h1>Accelerometer telemetry</h1>
  <button onclick="sensori()">Start</button>
  <h1></h1>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Ruadhan O'Donoghue">
  <meta charset="UTF-8">
</head>
<table id="myTable"><!--  creation of the first table -->
  <tr> <!--  the first row is compsed by the following attributes-->

  <th>X</th>
  <th>Y</th>
  <th>Z</th>
  </tr>

  <tr>  <!-- here I initialize an empty row that I will edit every time the telemetries update-->
    <td></td>
    <td></td>
    <td></td>

</tr>

<body>
  <div id="status">No data</div>
  <div id="ciao">ciao</div>
  <div id="ciao2">ciao2</div>

  

  <script>
    function sensori() {
    let status = document.getElementById('status');


    var xhttp3 = new XMLHttpRequest();
			xhttp3.open('POST', 'http://demo.thingsboard.io/api/plugins/telemetry/DEVICE/ba720a30-9364-11ea-9a66-358c6522b855/timeseries/SERVER_SCOPE');
			xhttp3.setRequestHeader('Content-Type', 'application/json');
			xhttp3.setRequestHeader('X-Authorization', 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJnaW92YW5uaS5ydW9jY283OTdAZ21haWwuY29tIiwic2NvcGVzIjpbIlRFTkFOVF9BRE1JTiJdLCJ1c2VySWQiOiIxYjEzMTcyMC02YTA4LTExZWEtYWQwMi1iMzU3NmI3ZDM5ZjEiLCJmaXJzdE5hbWUiOiJHaW92YW5uaSIsImxhc3ROYW1lIjoiUnVvY2NvIiwiZW5hYmxlZCI6dHJ1ZSwicHJpdmFjeVBvbGljeUFjY2VwdGVkIjp0cnVlLCJpc1B1YmxpYyI6ZmFsc2UsInRlbmFudElkIjoiMWFmNzlmZTAtNmEwOC0xMWVhLWFkMDItYjM1NzZiN2QzOWYxIiwiY3VzdG9tZXJJZCI6IjEzODE0MDAwLTFkZDItMTFiMi04MDgwLTgwODA4MDgwODA4MCIsImlzcyI6InRoaW5nc2JvYXJkLmlvIiwiaWF0IjoxNTg5MTg3MjA2LCJleHAiOjE1OTA5ODcyMDZ9.TbtDcPVidpBvsOpOZlU_1ZzVsOey3RiRWP6_aWNdjuqqGOVlaliizR9XybQOZb0n4Y0H62dTAt-dbMaMWzf0cQ');
			//var ciao = "'" + '{"x-asis":' + sensor.x.toFixed(10) + ', "y.axis":' + sensor.y.toFixed(10) + ', "z.axis":' + sensor.z.toFixed(10) + "}'" ;
      console.log("oooooooo");
      xhttp3.send('{"x-asis": ciao}');
      xhttp3.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
					

}

			};

    
    if ( 'Accelerometer' in window ) {
      ciao.innerHTML = "Entro nell'if";
      var sensor = new Accelerometer({frequency: 1});
      sensor.addEventListener('reading', () => {
      var table = document.getElementById("myTable");
      table.rows[1].cells[0].innerHTML = sensor.x.toFixed(10);  //in this way I add in each cell of the row sensor's data
      table.rows[1].cells[1].innerHTML = sensor.y.toFixed(10);
      table.rows[1].cells[2].innerHTML = sensor.z.toFixed(10);

      var xhttp3 = new XMLHttpRequest();
			xhttp3.open('POST', 'http://demo.thingsboard.io/api/plugins/telemetry/DEVICE/ba720a30-9364-11ea-9a66-358c6522b855/timeseries/SERVER_SCOPE');
			xhttp3.setRequestHeader('Content-Type', 'application/json');
			xhttp3.setRequestHeader('X-Authorization', 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJnaW92YW5uaS5ydW9jY283OTdAZ21haWwuY29tIiwic2NvcGVzIjpbIlRFTkFOVF9BRE1JTiJdLCJ1c2VySWQiOiIxYjEzMTcyMC02YTA4LTExZWEtYWQwMi1iMzU3NmI3ZDM5ZjEiLCJmaXJzdE5hbWUiOiJHaW92YW5uaSIsImxhc3ROYW1lIjoiUnVvY2NvIiwiZW5hYmxlZCI6dHJ1ZSwicHJpdmFjeVBvbGljeUFjY2VwdGVkIjp0cnVlLCJpc1B1YmxpYyI6ZmFsc2UsInRlbmFudElkIjoiMWFmNzlmZTAtNmEwOC0xMWVhLWFkMDItYjM1NzZiN2QzOWYxIiwiY3VzdG9tZXJJZCI6IjEzODE0MDAwLTFkZDItMTFiMi04MDgwLTgwODA4MDgwODA4MCIsImlzcyI6InRoaW5nc2JvYXJkLmlvIiwiaWF0IjoxNTg5MTg3MjA2LCJleHAiOjE1OTA5ODcyMDZ9.TbtDcPVidpBvsOpOZlU_1ZzVsOey3RiRWP6_aWNdjuqqGOVlaliizR9XybQOZb0n4Y0H62dTAt-dbMaMWzf0cQ');
			//var ciao = "'" + '{"x-asis":' + sensor.x.toFixed(10) + ', "y.axis":' + sensor.y.toFixed(10) + ', "z.axis":' + sensor.z.toFixed(10) + "}'" ;
      console.log("oooooooo");
      xhttp3.send('{"x-asis": ciao}');
      xhttp3.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
					

}

			};

      document.getElementById('status').innerHTML = 'x: ' + ciao + '<br> y: ' + sensor.y + '<br> z: ' + sensor.z;
      });

      sensor.start();
    }
    else status.innerHTML = 'Accelerometer not supported';
    }
  </script>

</body>
</html>